---
version: "3.9"
services:
  chaotic-builder:
    image: registry.gitlab.com/garuda-linux/tools/chaotic-manager/builder
    container_name: chaotic-builder
    network_mode: host
    command: builder
    environment:
      - REDIS_HOST=127.0.0.1
      - REDIS_PORT=6379
      - SHARED_PATH=/shared
    volumes:
      - ./shared:/shared
      - ./sshkey:/app/sshkey
      - /var/run/docker.sock:/var/run/docker.sock
  chaotic-manager:
    image: registry.gitlab.com/garuda-linux/tools/chaotic-manager/manager:latest
    container_name: chaotic-manager
    network_mode: host
    command: database
    environment:
      - DATABASE_HOST=127.0.0.1
      - DATABASE_PORT=22
      - DATABASE_USER=package-deployer
      - GPG_PATH=/home/package-deployer/.gnupg
      - LANDING_ZONE_PATH=/home/package-deployer/landing-zone
      - REDIS_HOST=127.0.0.1
      - REDIS_PORT=6379
      - REPO_PATH=/srv/http/repos
    volumes:
      - ./sshkey:/app/sshkey
      - /var/run/docker.sock:/var/run/docker.sock

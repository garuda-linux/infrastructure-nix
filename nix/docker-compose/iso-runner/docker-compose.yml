version: "3.9"
services:
  github-runner:
    image: myoung34/github-runner:latest
    container_name: github-runner
    environment:
      ACCESS_TOKEN: ${ACCESS_TOKEN:-?err}
      EPHEMERAL: true
      LABELS: nyxbuilder
      ORG_NAME: chaotic-cx
      RUNNER_NAME: immortalis
      RUNNER_SCOPE: "org"
      RUNNER_WORKDIR: /tmp/runner/work
    security_opt:
      # needed on SELinux systems to allow docker container to manage other docker containers
      - label:disable
    volumes:
      - "/tmp/runner:/tmp/runner"
      - "/var/run/docker.sock:/var/run/docker.sock"
    restart: always

  # Automated container updates
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    command: --cleanup github-runner
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    restart: always